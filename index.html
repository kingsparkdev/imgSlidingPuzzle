<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Image Sliding Game</title>
</head>

<body>

    <div id="slider">
        <form>
            <label>Easy</label>
            <input type="range" id="scale" value="4" min="3" max="5" step="1">
            <label>Hard</label>
        </form>
        <br>
    </div>
    <div id="main" class="main">
        <canvas id="puzzle" width="480px" height="480px"></canvas>
    </div>

    <script>
        var context = document.getElementById("puzzle").getContext("2d");
        var img = new Image();
        img.src = 'https://media.vlpt.us/images/kingsparkdev/post/ff635a6a-4069-4230-966d-f87d5009ba91/KakaoTalk_20211030_203358297.jpg';
        img.addEventListener('load', drawTiles, false);

        var boardSize = document.getElementById('puzzle').width;
        var tileCount = document.getElementById('scale').value;
        var tileSize = boardSize / tileCount;

        var boardParts = new Object;

        var clickLoc = new Object;
        clickLoc.x = 0;
        clickLoc.y = 0;

        var emptyLoc = new Object;
        emptyLoc.x = 0;
        emptyLoc.y = 0;

        var solved = false;

        setBoard();

        document.getElementById('scale').onchange = function () {
            tileCount = this.value;
            tileSize = boardSize / tileCount;
            setBoard();
            drawTiles();
        };

        document.getElementById('puzzle').onmousemove = function (e) {
            clickLoc.x = Math.floor((e.pageX - this.offsetLeft) / tileSize);
            clickLoc.y = Math.floor((e.pageY - this.offsetTop) / tileSize);
        };

        document.getElementById('puzzle').onclick = function () {
            if (distance(clickLoc.x, clickLoc.y, emptyLoc.x, emptyLoc.y) == 1) {
                slideTile(emptyLoc, clickLoc);
                drawTiles();
            };
            if (solved) {
                setTimeout(function () { alert("You solved it!"); }, 500);
            };
        };

        function distance(x1, y1, x2, y2) {
            return Math.abs(x1 - x2) + Math.abs(y1 - y2);
        };

        function slideTile(toLoc, fromLoc) {
            if (!solved) {
                boardParts[toLoc.x][toLoc.y].x = boardParts[fromLoc.x][fromLoc.y].x;
                boardParts[toLoc.x][toLoc.y].y = boardParts[fromLoc.x][fromLoc.y].y;
                boardParts[fromLoc.x][fromLoc.y].x = tileCount - 1;
                boardParts[fromLoc.x][fromLoc.y].y = tileCount - 1;
                toLoc.x = fromLoc.x;
                toLoc.y = fromLoc.y;
                checkSolved();
            };
        };

        function checkSolved() {
            var flag = true;
            for (var i = 0; i < tileCount; ++i) {
                for (var j = 0; j < tileCount; ++j) {
                    if (boardParts[i][j].x != i || boardParts[i][j].y != j) {
                        flag = false;
                    };
                };
            };
            solved = flag;
        };

        function drawTiles() {
            context.clearRect(0, 0, boardSize, boardSize);
            for (var i = 0; i < tileCount; ++i) {
                for (var j = 0; j < tileCount; ++j) {
                    var x = boardParts[i][j].x;
                    var y = boardParts[i][j].y;
                    if (i != emptyLoc.x || j != emptyLoc.y || solved == true) {
                        context.drawImage(img, x * tileSize, y * tileSize, tileSize, tileSize,
                            i * tileSize, j * tileSize, tileSize, tileSize);
                    };
                };
            };
        };

        function setBoard() {
            var randomCord = makeCordArray(tileCount);
            shuffle(randomCord);
            var numa = 0;
            boardParts = new Array(tileCount);
            for (var i = 0; i < tileCount; ++i) {
                boardParts[i] = new Array(tileCount);
                for (var j = 0; j < tileCount; ++j) {
                    boardParts[i][j] = new Object;
                    boardParts[i][j].x = randomCord[numa][0];
                    boardParts[i][j].y = randomCord[numa][1];
                    console.log(i, j, boardParts[i][j].x, boardParts[i][j].y);
                    numa++;
                };
            };
            emptyLoc.x = boardParts[tileCount - 1][tileCount - 1].x;
            emptyLoc.y = boardParts[tileCount - 1][tileCount - 1].y;
            solved = false;
        };

        function makeCordArray(tileCount) {
            var randArray = new Array();
            for (var i = 0; i < tileCount; ++i) {
                for (var j = 0; j < tileCount; ++j) {
                    randArray.push([i, j]);
                };
            };
            return randArray;
        };

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>