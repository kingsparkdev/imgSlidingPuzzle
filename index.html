<!doctype html>
<html lang="en">

<head>
    <title>aespa Image Sliding Game</title>
    <link rel="icon" type="text/png" href="https://media.discordapp.net/attachments/904673398439940108/904749382312808448/KakaoTalk_20211102_000543309_16.jpg?width=128&height=128">
    <meta name=”description” content="aespa Image Sliding Game">
    <meta name="keywords" content="aespa,puzzle,game,site,winter,karina,ningning,giselle">
    <link rel="canonical" href="https://kingsparkdev.github.io/imgSlidingPuzzle/">

    <meta property="og:title" content="aespa Image Sliding Game" />
    <meta property="og:description" content="aespa Image Sliding Game" />
    <meta property="og:image" content="https://media.discordapp.net/attachments/904673398439940108/904749382312808448/KakaoTalk_20211102_000543309_16.jpg" />
    <meta property="og:url" content="https://kingsparkdev.github.io/imgSlidingPuzzle/" />
    <meta property="og:site_name" content="aespa Image Sliding Game" />

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
</head>

<body>

    <div id="slider">
        <form>
            <label>Easy</label>
            <input type="range" id="scale" value="4" min="3" max="5" step="1">
            <label>Hard</label>
        </form>
        <br>
    </div>
    <div id="main" class="main">
        <canvas id="puzzle"></canvas>
    </div>
    <img id="preview" src="" class="mt-5 mb-5" style="object-fit: cover; object-position: 100% 0;">

    <script>
        let context = document.getElementById("puzzle").getContext("2d");
        if (window.innerWidth <= 600) {
            $('#puzzle').attr('width', `${window.innerWidth * 0.8}px`);
            $('#puzzle').attr('height', `${window.innerWidth * 0.8}px`);
        } else {
            $('#puzzle').attr('width', '480px');
            $('#puzzle').attr('height', '480px');
        }
        let img = new Image();
        let item = [
            'https://media.discordapp.net/attachments/904673398439940108/904743053074530376/KakaoTalk_20211031_022515919_06.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904743056069230652/KakaoTalk_20211031_022515919_07.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748573198000159/KakaoTalk_20211102_000543309.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748573609046086/KakaoTalk_20211102_000543309_09.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748574343061574/KakaoTalk_20211102_000543309_01.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748575471325214/KakaoTalk_20211102_000543309_02.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748575911714866/KakaoTalk_20211102_000543309_03.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748578017271868/KakaoTalk_20211102_000543309_04.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748580701614080/KakaoTalk_20211102_000543309_05.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748580626108416/KakaoTalk_20211102_000543309_06.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748582123499620/KakaoTalk_20211102_000543309_07.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904748582870081606/KakaoTalk_20211102_000543309_08.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749376860192769/KakaoTalk_20211102_000543309_10.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749377472594010/KakaoTalk_20211102_000543309_11.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749377644544040/KakaoTalk_20211102_000543309_12.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749378579873832/KakaoTalk_20211102_000543309_13.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749379968172082/KakaoTalk_20211102_000543309_14.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749381981458472/KakaoTalk_20211102_000543309_15.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749382312808448/KakaoTalk_20211102_000543309_16.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749384414146570/KakaoTalk_20211102_000543309_18.jpg',
            'https://media.discordapp.net/attachments/904673398439940108/904749386150588466/KakaoTalk_20211102_000543309_17.jpg',
        ];
        const rand_int_len = Math.floor(Math.random() * (item.length - 2));
        img.src = item[rand_int_len]+`?width=${$('#puzzle').width()}&height=${$('#puzzle').height()}`;
        $('#preview').attr('src', item[rand_int_len]);

        // img.width = document.getElementById('puzzle').width;
        img.addEventListener('load', drawTiles, false);

        let boardSize = document.getElementById('puzzle').width;
        let tileCount = document.getElementById('scale').value;
        let tileSize = boardSize / tileCount;

        let boardParts = new Object;

        let clickLoc = new Object;
        clickLoc.x = 0;
        clickLoc.y = 0;

        let emptyLoc = new Object;
        emptyLoc.x = 0;
        emptyLoc.y = 0;

        let solved = false;

        let shuffledDeck = shuffle(makeCordArray(tileCount));
        solvableContent(shuffledDeck);

        setBoard();

        document.getElementById('scale').onchange = function () {
            tileCount = this.value;
            tileSize = boardSize / tileCount;
            shuffledDeck = shuffle(makeCordArray(tileCount));
            solvableContent(shuffledDeck);
            setBoard();
            drawTiles();
        };

        document.getElementById('puzzle').onmousemove = function (e) {
            clickLoc.x = Math.floor((e.pageX - this.offsetLeft) / tileSize);
            clickLoc.y = Math.floor((e.pageY - this.offsetTop) / tileSize);
        };

        document.getElementById('puzzle').onclick = function () {
            if (distance(clickLoc.x, clickLoc.y, emptyLoc.x, emptyLoc.y) == 1) {
                slideTile(emptyLoc, clickLoc);
                drawTiles();
            };
            if (solved) {
                setTimeout(function () { alert("You solved it!"); }, 500);
            };
        };

        function solvableContent(oneDArr) {
            let filterSolvable = [];
            oneDArr.forEach(elem => {
                filterSolvable.push(elem[0] * 4 + elem[1]);
            });
            let inversions = 0;
            if (tileCount % 2 === 1) {
                for (let k = 0; k < filterSolvable.length - 1; ++k) {
                    for (let t = k+1; t < filterSolvable.length; ++t) {
                        if (filterSolvable[k] > filterSolvable[t]) {
                            inversions++;
                        }
                    }
                }
                if (inversions % 2 === 0) {
                    shuffledDeck = oneDArr;
                    console.log("solvable: ",shuffledDeck);
                } else {
                    console.log("un-solvable");
                    solvableContent(shuffle(makeCordArray(tileCount)));
                }
            } else {
                for (let k = 0; k < filterSolvable.length - 1; ++k) {
                    for (let t = k+1; t < filterSolvable.length; ++t) {
                        if (filterSolvable[k] > filterSolvable[t]) {
                            inversions++;
                        }
                    }
                }
                if (Math.floor(filterSolvable.indexOf(0) / tileCount - 1) % 2 === 1 && inversions % 2 === 0) {
                    shuffledDeck = oneDArr;
                    console.log("solvable: ",shuffledDeck);
                } else if (Math.floor(filterSolvable.indexOf(0) / tileCount - 1) % 2 === 0 && inversions % 2 === 1) {
                    shuffledDeck = oneDArr;
                    console.log("solvable: ",shuffledDeck);
                } else {
                    console.log("un-solvable");
                    solvableContent(shuffle(makeCordArray(tileCount)));
                }
            }
        }

        function distance(x1, y1, x2, y2) {
            return Math.abs(x1 - x2) + Math.abs(y1 - y2);
        }

        function slideTile(toLoc, fromLoc) {
            if (!solved) {
                boardParts[toLoc.x][toLoc.y].x = boardParts[fromLoc.x][fromLoc.y].x;
                boardParts[toLoc.x][toLoc.y].y = boardParts[fromLoc.x][fromLoc.y].y;
                boardParts[fromLoc.x][fromLoc.y].x = tileCount - 1;
                boardParts[fromLoc.x][fromLoc.y].y = tileCount - 1;
                toLoc.x = fromLoc.x;
                toLoc.y = fromLoc.y;
                checkSolved();
            }
        }

        function checkSolved() {
            let flag = true;
            let numb = 0;
            for (let i = 0; i < tileCount; ++i) {
                for (let j = 0; j < tileCount; ++j) {
                    if (boardParts[i][j].x !== i || boardParts[i][j].y !== j) {
                        flag = false;
                    };
                    numb++;
                }
            }
            solved = flag;
        }

        function drawTiles() {
            context.clearRect(0, 0, boardSize, boardSize);
            for (let i = 0; i < tileCount; ++i) {
                for (let j = 0; j < tileCount; ++j) {
                    let x = boardParts[i][j].x;
                    let y = boardParts[i][j].y;
                    if (i != emptyLoc.x || j != emptyLoc.y || solved == true) {
                        context.drawImage(img, x * tileSize, y * tileSize, tileSize, tileSize,
                            i * tileSize, j * tileSize, tileSize, tileSize);
                    }
                }
            }
        }

        function setBoard() {
            let numa = 0;
            let threeLocx = 0;
            let threeLocy = 0;
            boardParts = new Array(tileCount);
            for (let i = 0; i < tileCount; ++i) {
                boardParts[i] = new Array(tileCount);
                for (let j = 0; j < tileCount; ++j) {
                    boardParts[i][j] = new Object;
                    boardParts[i][j].x = shuffledDeck[numa][0];
                    boardParts[i][j].y = shuffledDeck[numa][1];
                    if (shuffledDeck[numa][0] === tileCount - 1 && shuffledDeck[numa][1] === tileCount - 1) {
                        threeLocx = i;
                        threeLocy = j;
                        emptyLoc.x = threeLocx
                        emptyLoc.y = threeLocy;
                    }
                    // console.log(i, j, boardParts[i][j].x, boardParts[i][j].y);
                    numa++;
                }
            }
            solved = false;
        }

        function makeCordArray(tileCount) {
            let randArray = new Array();
            for (let i = 0; i < tileCount; ++i) {
                for (let j = 0; j < tileCount; ++j) {
                    randArray.push([i, j]);
                }
            }
            return randArray;
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>